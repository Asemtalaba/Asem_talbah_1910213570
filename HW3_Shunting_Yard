#include <stdio.h>
#include <ctype.h>

#define MAX 200

/*
Name: Asem Talbah
Student ID: 1910213570
Course: Data Structure
HW: 3
Topic: Shunting Yard (Infix to Postfix)
*/

typedef struct {
    char data[MAX];
    int top;
} Stack;

void init(Stack* s) { s->top = -1; }
int isEmpty(Stack* s) { return s->top == -1; }
char peek(Stack* s) { return s->data[s->top]; }
void push(Stack* s, char c) { s->data[++s->top] = c; }
char pop(Stack* s) { return s->data[s->top--]; }

int precedence(char op) {
    if (op == '^') return 3;
    if (op == '*' || op == '/') return 2;
    if (op == '+' || op == '-') return 1;
    return 0;
}

int isOperator(char c) {
    return (c == '+' || c == '-' || c == '*' || c == '/' || c == '^');
}

int main() {
    char infix[MAX], postfix[MAX];
    Stack st;
    init(&st);

    printf("Enter infix expression: ");
    fgets(infix, MAX, stdin);

    int i = 0, j = 0;

    while (infix[i] != '\0' && infix[i] != '\n') {
        char token = infix[i];

        if (isspace((unsigned char)token)) {
            i++;
            continue;
        }

        // Operand (letter or digit)
        if (isalnum((unsigned char)token)) {
            postfix[j++] = token;
        }
        // Left parenthesis
        else if (token == '(') {
            push(&st, token);
        }
        // Right parenthesis
        else if (token == ')') {
            while (!isEmpty(&st) && peek(&st) != '(') {
                postfix[j++] = pop(&st);
            }
            if (!isEmpty(&st) && peek(&st) == '(')
                pop(&st); // remove '('
        }
        // Operator
        else if (isOperator(token)) {
            while (!isEmpty(&st) && isOperator(peek(&st)) &&
                   precedence(peek(&st)) >= precedence(token)) {
                postfix[j++] = pop(&st);
            }
            push(&st, token);
        }
        else {
            printf("Invalid character: %c\n", token);
            return 0;
        }

        i++;
    }

    while (!isEmpty(&st)) {
        if (peek(&st) == '(') {
            printf("Error: Mismatched parentheses\n");
            return 0;
        }
        postfix[j++] = pop(&st);
    }

    postfix[j] = '\0';

    printf("Postfix: %s\n", postfix);

    return 0;
}
